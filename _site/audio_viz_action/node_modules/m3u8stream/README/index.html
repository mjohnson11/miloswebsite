<h1>node-m3u8stream</h1>
<p>Reads segments from a <a href="https://tools.ietf.org/html/draft-pantos-http-live-streaming-20">m3u8 playlist</a> or <a href="http://standards.iso.org/ittf/PubliclyAvailableStandards/MPEG-DASH_schema_files/DASH-MPD.xsd">DASH MPD file</a> into a consumable stream.</p>
<p><a href="http://travis-ci.org/fent/node-m3u8stream"><img src="https://secure.travis-ci.org/fent/node-m3u8stream.svg" alt="Build Status"></a>
<a href="https://david-dm.org/fent/node-m3u8stream"><img src="https://david-dm.org/fent/node-m3u8stream.svg" alt="Dependency Status"></a>
<a href="https://codecov.io/gh/fent/node-m3u8stream"><img src="https://codecov.io/gh/fent/node-m3u8stream/branch/master/graph/badge.svg" alt="codecov"></a></p>
<h1>Usage</h1>
<pre><code class="language-js">const fs = require('fs');
const m3u8stream = require('m3u8stream')

m3u8stream('http://somesite.com/link/to/the/playlist.m3u8')
    .pipe(fs.createWriteStream('videofile.mp4'));
</code></pre>
<h1>API</h1>
<h3>m3u8stream(url, [options])</h3>
<p>Creates a readable stream of binary media data. <code>options</code> can have the following</p>
<ul>
<li><code>begin</code> - Where to begin playing the video. Accepts an absolute unix timestamp or date, and a relative time in the formats <code>1:23:45.123</code> and <code>1m2s</code>.</li>
<li><code>liveBuffer</code> - How much buffer in milliseconds to have for live streams. Default is <code>20000</code>.</li>
<li><code>chunkReadahead</code> - How many chunks to preload ahead. Default is <code>3</code>.</li>
<li><code>highWaterMark</code> - How much of the download to buffer into the stream. See <a href="https://nodejs.org/api/stream.html#stream_constructor_new_stream_writable_options">node's docs</a> for more. Note that the actual amount buffered can be higher since each chunk request maintains its own buffer.</li>
<li><code>requestOptions</code> - Any options you want to pass to <a href="https://github.com/fent/node-miniget">miniget</a>, such as <code>headers</code>.</li>
<li><code>parser</code> - Either &quot;m3u8&quot; or &quot;dash-mpd&quot;. Defaults to guessing based on the playlist url ending in <code>.m3u8</code> or <code>.mpd</code>.</li>
<li><code>id</code> - For playlist containing multiple media options. If not given, the first representation will be picked.</li>
</ul>
<h3>Stream#end()</h3>
<p>If called, stops requesting segments, and refreshing the playlist.</p>
<h4>Event: progress</h4>
<ul>
<li><code>Object</code> - Current segment with the following fields,
<ul>
<li><code>number</code> - number</li>
<li><code>number</code> - size</li>
<li><code>number</code> - duration</li>
<li><code>string</code> - url</li>
</ul>
</li>
<li><code>number</code> - Total number of segments.</li>
<li><code>number</code> - Bytes downloaded up to this point.</li>
</ul>
<p>For static non-live playlists, emitted each time a segment has finished downloading. Since total download size is unknown until all segment endpoints are hit, progress is calculated based on how many segments are available.</p>
<h3>Limitations</h3>
<p>Currently, it does not support <a href="https://tools.ietf.org/html/draft-pantos-http-live-streaming-20#section-4.3.2.4">encrypted media segments</a>. This is because the sites where this was tested on and intended for, YouTube and Twitch, don't use it.</p>
<p>This does not parse master playlists, only media playlists. If you want to parse a master playlist to get links to media playlists, you can try the <a href="https://github.com/tedconf/node-m3u8">m3u8 module</a>.</p>
<h1>Install</h1>
<pre><code>npm install m3u8stream
</code></pre>
<h1>Tests</h1>
<p>Tests are written with <a href="https://mochajs.org">mocha</a></p>
<pre><code class="language-bash">npm test
</code></pre>
